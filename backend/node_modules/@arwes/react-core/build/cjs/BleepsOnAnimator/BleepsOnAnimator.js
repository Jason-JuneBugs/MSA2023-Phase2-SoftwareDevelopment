"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BleepsOnAnimator = void 0;
const tslib_1 = require("tslib");
const react_1 = require("react");
const react_2 = tslib_1.__importStar(require("react"));
const react_animator_1 = require("@arwes/react-animator");
const react_bleeps_1 = require("@arwes/react-bleeps");
const BleepsOnAnimator = (props) => {
    const { id: externalId, transitions, continuous } = props;
    const internalId = (0, react_2.useId)();
    const transitionsRef = (0, react_1.useRef)(transitions);
    const animator = (0, react_animator_1.useAnimator)();
    const bleeps = (0, react_bleeps_1.useBleeps)();
    // To prevent multiple executions of the useEffect to check for Animator node updates.
    transitionsRef.current = transitions;
    const id = externalId || internalId;
    (0, react_2.useEffect)(() => {
        if (!animator) {
            return;
        }
        let currentBleep = null;
        const cancelSubscription = animator.node.subscribe(node => {
            const bleepName = transitionsRef.current[node.state];
            if (!continuous) {
                currentBleep === null || currentBleep === void 0 ? void 0 : currentBleep.stop(id);
            }
            const newBleep = bleeps[bleepName];
            if (newBleep) {
                currentBleep === null || currentBleep === void 0 ? void 0 : currentBleep.stop(id);
                currentBleep = newBleep;
                currentBleep.play(id);
            }
        });
        return () => {
            cancelSubscription();
            currentBleep === null || currentBleep === void 0 ? void 0 : currentBleep.stop(id);
        };
    }, [id, animator, bleeps]);
    return react_2.default.createElement(react_2.default.Fragment, null);
};
exports.BleepsOnAnimator = BleepsOnAnimator;
